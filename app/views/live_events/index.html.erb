<!-- ページタイトル -->
<div class="row align-items-center mb-4 fade-in">
  <div class="col">
    <h1 class="display-5 fw-bold text-primary mb-2 title-hover">
      <i class="fas fa-search me-3 icon-pulse"></i>ライブ検索
    </h1>
    <p class="lead text-muted slide-in">全国のライブ・コンサート情報をチェックしよう！</p>
  </div>
</div>

<style>
  /* 基本アニメーション */
  .fade-in {
    opacity: 0;
    animation: fadeInUp 0.8s ease forwards;
  }
  
  .slide-in {
    opacity: 0;
    transform: translateX(-30px);
    animation: slideInLeft 1s ease 0.3s forwards;
  }
  
  @keyframes fadeInUp {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  @keyframes slideInLeft {
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }
  
  /* ホバー効果 */
  .title-hover:hover {
    transform: scale(1.02);
    transition: all 0.3s ease;
    text-shadow: 0 2px 10px rgba(102, 126, 234, 0.3);
  }
  
  /* アイコンアニメーション */
  .icon-pulse {
    animation: iconPulse 2s infinite;
  }
  
  @keyframes iconPulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.2); }
  }
  
  /* カードホバー効果 */
  .hover-card {
    transition: all 0.3s ease;
  }
  
  .hover-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 15px 35px rgba(0,0,0,0.15) !important;
  }
  
  /* 検索カードのホバー */
  .search-card:hover {
    transform: translateY(-3px);
    transition: all 0.3s ease;
  }
  
  /* ボタンのホバー効果 */
  .btn:hover {
    transform: translateY(-2px);
    transition: all 0.3s ease;
  }
  
  /* アイコンの個別アニメーション */
  .icon-rotate:hover {
    transform: rotateY(360deg);
    transition: transform 0.6s ease;
  }
  
  .icon-bounce:hover {
    animation: iconBounce 0.6s ease;
  }
  
  @keyframes iconBounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-5px); }
  }
  
  /* バッジのパルス */
  .badge {
    animation: badgePulse 3s infinite;
  }
  
  @keyframes badgePulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
  }
</style>


<!-- 検索セクション -->
<div class="card shadow-sm mb-4 search-card">
  <div class="card-body">
    <%= form_with url: live_events_path, method: :get, local: true, class: "search-form" do |form| %>
      <div class="row g-3 align-items-end">
        <div class="col-md-4">
          <label class="form-label fw-semibold">
            <i class="fas fa-search me-1 icon-rotate"></i>キーワード検索
          </label>
          <%= form.text_field :search,
              value: params[:search],
              placeholder: "アーティスト名、ライブタイトル、会場名...",
              class: "form-control form-control-lg" %>
        </div>

        <div class="col-md-3">
          <label class="form-label fw-semibold">
            <i class="fas fa-map-marker-alt me-1 icon-bounce"></i>都道府県
          </label>
          <%= form.select :prefecture,
              options_for_select([
                ['全ての都道府県', ''],
                ['東京都', '東京都'], ['大阪府', '大阪府'], ['神奈川県', '神奈川県'],
                ['愛知県', '愛知県'], ['福岡県', '福岡県'], ['北海道', '北海道'],
                ['宮城県', '宮城県'], ['埼玉県', '埼玉県'], ['千葉県', '千葉県'],
                ['兵庫県', '兵庫県'], ['京都府', '京都府'], ['広島県', '広島県']
              ], params[:prefecture]),
              {},
              { class: "form-select form-select-lg" } %>
        </div>

        <div class="col-md-3">
          <label class="form-label fw-semibold">
            <i class="fas fa-calendar me-1 icon-bounce"></i>開催日
          </label>
          <div class="input-group">
            <%= form.date_field :date_from, value: params[:date_from], class: "form-control" %>
            <span class="input-group-text">〜</span>
            <%= form.date_field :date_to, value: params[:date_to], class: "form-control" %>
          </div>
        </div>

        <div class="col-md-2">
          <div class="d-grid gap-2">
            <%= form.submit "🔍 検索", class: "btn btn-gradient btn-lg" %>
            <%= link_to "クリア", live_events_path, class: "btn btn-outline-secondary" %>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>

<!-- 外部API検索結果 -->
<% if @api_events&.any? %>
  <div class="mb-5">
    <div class="row align-items-center mb-3">
      <div class="col">
        <h3 class="text-primary">
          <i class="fas fa-star me-2"></i>近日開催予定のライブ
        </h3>
        <p class="text-muted">「<%= params[:search] %>」の検索結果: <%= @api_events.count %>件</p>
      </div>
    </div>
    
    <div class="row">
      <% @api_events.each do |event| %>
        <div class="col-md-6 col-lg-4 mb-4">
          <div class="card h-100 hover-card shadow-sm">
            <div class="card-header bg-gradient text-white" style="background: linear-gradient(45deg, #667eea, #764ba2);">
              <h6 class="mb-0">
                <i class="fas fa-microphone me-2"></i>
                <%= event[:artist] %>
              </h6>
            </div>
            <div class="card-body">
              <h6 class="card-title">
                <i class="fas fa-map-marker-alt me-2 text-primary"></i>
                <%= event[:venue_name] %>
              </h6>
              <p class="card-text">
                <small class="text-muted">
                  <i class="fas fa-location-dot me-1"></i>
                  <%= event[:venue_city] %>, <%= event[:venue_country] %>
                </small>
              </p>
              <p class="card-text">
                <i class="fas fa-calendar me-2 text-primary"></i>
                <%= Time.parse(event[:date]).strftime("%Y年%m月%d日 %H:%M") rescue event[:date] %>
              </p>
              <% if event[:description].present? %>
                <p class="card-text">
                  <small class="text-muted"><%= event[:description] %></small>
                </p>
              <% end %>
            </div>
            <div class="card-footer bg-transparent">
              <a href="<%= event[:ticket_url] %>" target="_blank" class="btn btn-success btn-sm w-100">
                <i class="fas fa-ticket-alt me-1"></i>チケット情報
              </a>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  </div>
<% elsif params[:search].present? && @api_events&.empty? %>
  <div class="alert alert-info mb-4">
    <i class="fas fa-info-circle me-2"></i>
    「<%= params[:search] %>」の外部ライブ情報が見つかりませんでした。
  </div>
<% end %>


<!-- ライブ一覧 -->
<div class="row">
  <% if @live_events.any? %>
    <% @live_events.each do |live_event| %>
      <div class="col-lg-6 mb-4">
        <div class="card h-100 shadow-sm hover-card">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-start mb-3">
              <h5 class="card-title text-primary mb-0">
                <%= link_to live_event.title, live_event_path(live_event), 
                    class: "text-decoration-none text-primary" %>
              </h5>
              <span class="badge bg-primary"><%= live_event.prefecture %></span>
            </div>

            <div class="mb-3">
              <p class="mb-2 text-dark">
                <i class="fas fa-microphone-alt text-primary me-2 icon-rotate"></i>
                <strong><%= live_event.artist %></strong>
              </p>
              <p class="mb-2 text-muted">
                <i class="fas fa-map-marker-alt text-primary me-2 icon-bounce"></i>
                <%= live_event.venue %>
              </p>
              <p class="mb-2 text-muted">
                <i class="fas fa-calendar-alt text-primary me-2 icon-bounce"></i>
                <%= live_event.date.strftime("%Y年%m月%d日 %H:%M") if live_event.date %>
              </p>
              <% if live_event.price %>
                <p class="mb-2 text-success fw-bold">
                  <i class="fas fa-yen-sign text-primary me-2 icon-rotate"></i>
                  ¥<%= number_with_delimiter(live_event.price) %>
                </p>
              <% end %>
            </div>

            <% if live_event.description.present? %>
              <p class="card-text text-muted small mb-3">
                <%= truncate(live_event.description, length: 80) %>
              </p>
            <% end %>

            <div class="d-flex justify-content-between align-items-center">
              <!-- お気に入りボタン -->
              <div class="favorite-section">
                <% if current_user %>
                  <% if current_user.favorited?(live_event) %>
                    <%= button_to unfavorite_live_event_path(live_event),
                                  method: :delete,
                                  class: "btn btn-outline-danger btn-sm",
                                  title: "お気に入りから削除" do %>
                      <i class="fas fa-heart me-1"></i>
                      <span class="badge bg-danger"><%= live_event.favorites.count %></span>
                    <% end %>
                  <% else %>
                    <%= button_to favorite_live_event_path(live_event),
                                  method: :post,
                                  class: "btn btn-outline-primary btn-sm",
                                  title: "お気に入りに追加" do %>
                      <i class="far fa-heart me-1"></i>
                      <span class="badge bg-primary"><%= live_event.favorites.count %></span>
                    <% end %>
                  <% end %>
                <% else %>
                  <%= link_to login_path, class: "btn btn-outline-secondary btn-sm", 
                      title: "ログインしてお気に入り登録" do %>
                    <i class="far fa-heart me-1"></i>
                    <span class="badge bg-secondary">0</span>
                  <% end %>
                <% end %>
              </div>

              <!-- アクションボタン -->
              <div class="btn-group">
                <%= link_to "詳細", live_event_path(live_event), 
                    class: "btn btn-outline-primary btn-sm" %>
                <% if live_event.ticket_url.present? %>
                  <%= link_to "チケット", live_event.ticket_url, target: "_blank", 
                      class: "btn btn-success btn-sm" %>
                <% end %>
              </div>
            </div>
          </div>
        </div>
      </div>
    <% end %>
   <% else %>
  <% end %>
</div>
