<!-- „Éö„Éº„Ç∏„Çø„Ç§„Éà„É´ -->
<div class="row align-items-center mb-4">
  <div class="col">
    <h1 class="display-5 fw-bold text-primary mb-2">
      <i class="fas fa-search me-3"></i>„É©„Ç§„ÉñÊ§úÁ¥¢
    </h1>
    <p class="lead text-muted">ÂÖ®ÂõΩ„ÅÆ„É©„Ç§„Éñ„Éª„Ç≥„É≥„Çµ„Éº„ÉàÊÉÖÂ†±„Çí„ÉÅ„Çß„ÉÉ„ÇØ„Åó„Çà„ÅÜÔºÅ</p>
  </div>
</div>

<!-- Ê§úÁ¥¢„Çª„ÇØ„Ç∑„Éß„É≥ -->
<div class="card shadow-sm mb-4">
  <div class="card-body">
    <%= form_with url: live_events_path, method: :get, local: true, class: "search-form" do |form| %>
      <div class="row g-3 align-items-end">
        <div class="col-md-4">
          <label class="form-label fw-semibold">
            <i class="fas fa-search me-1"></i>„Ç≠„Éº„ÉØ„Éº„ÉâÊ§úÁ¥¢
          </label>
          <%= form.text_field :search,
              value: params[:search],
              placeholder: "„Ç¢„Éº„ÉÜ„Ç£„Çπ„ÉàÂêç„ÄÅ„É©„Ç§„Éñ„Çø„Ç§„Éà„É´„ÄÅ‰ºöÂ†¥Âêç...",
              class: "form-control form-control-lg" %>
        </div>

        <div class="col-md-3">
          <label class="form-label fw-semibold">
            <i class="fas fa-map-marker-alt me-1"></i>ÈÉΩÈÅìÂ∫úÁúå
          </label>
          <%= form.select :prefecture,
              options_for_select([
                ['ÂÖ®„Å¶„ÅÆÈÉΩÈÅìÂ∫úÁúå', ''],
                ['Êù±‰∫¨ÈÉΩ', 'Êù±‰∫¨ÈÉΩ'], ['Â§ßÈò™Â∫ú', 'Â§ßÈò™Â∫ú'], ['Á•ûÂ•àÂ∑ùÁúå', 'Á•ûÂ•àÂ∑ùÁúå'],
                ['ÊÑõÁü•Áúå', 'ÊÑõÁü•Áúå'], ['Á¶èÂ≤°Áúå', 'Á¶èÂ≤°Áúå'], ['ÂåóÊµ∑ÈÅì', 'ÂåóÊµ∑ÈÅì'],
                ['ÂÆÆÂüéÁúå', 'ÂÆÆÂüéÁúå'], ['ÂüºÁéâÁúå', 'ÂüºÁéâÁúå'], ['ÂçÉËëâÁúå', 'ÂçÉËëâÁúå'],
                ['ÂÖµÂ∫´Áúå', 'ÂÖµÂ∫´Áúå'], ['‰∫¨ÈÉΩÂ∫ú', '‰∫¨ÈÉΩÂ∫ú'], ['Â∫ÉÂ≥∂Áúå', 'Â∫ÉÂ≥∂Áúå']
              ], params[:prefecture]),
              {},
              { class: "form-select form-select-lg" } %>
        </div>

        <div class="col-md-3">
          <label class="form-label fw-semibold">
            <i class="fas fa-calendar me-1"></i>ÈñãÂÇ¨Êó•
          </label>
          <div class="input-group">
            <%= form.date_field :date_from, value: params[:date_from], class: "form-control" %>
            <span class="input-group-text">„Äú</span>
            <%= form.date_field :date_to, value: params[:date_to], class: "form-control" %>
          </div>
        </div>

        <div class="col-md-2">
          <div class="d-grid gap-2">
            <%= form.submit "üîç Ê§úÁ¥¢", class: "btn btn-gradient btn-lg" %>
            <%= link_to "„ÇØ„É™„Ç¢", live_events_path, class: "btn btn-outline-secondary" %>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>

<!-- „É©„Ç§„Éñ‰∏ÄË¶ß -->
<div class="row">
  <% if @live_events.any? %>
    <% @live_events.each do |live_event| %>
      <div class="col-lg-6 mb-4">
        <div class="card h-100 shadow-sm hover-card">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-start mb-3">
              <h5 class="card-title text-primary mb-0">
                <%= link_to live_event.title, live_event_path(live_event),
                    class: "text-decoration-none text-primary" %>
              </h5>
              <span class="badge bg-primary"><%= live_event.prefecture %></span>
            </div>

            <div class="mb-3">
              <p class="mb-2 text-dark">
                <i class="fas fa-microphone-alt text-primary me-2"></i>
                <strong><%= live_event.artist %></strong>
              </p>
              <p class="mb-2 text-muted">
                <i class="fas fa-map-marker-alt text-primary me-2"></i>
                <%= live_event.venue %>
              </p>
              <p class="mb-2 text-muted">
                <i class="fas fa-calendar-alt text-primary me-2"></i>
                <%= live_event.date.strftime("%YÂπ¥%mÊúà%dÊó• %H:%M") if live_event.date %>
              </p>
              <% if live_event.price %>
                <p class="mb-2 text-success fw-bold">
                  <i class="fas fa-yen-sign text-primary me-2"></i>
                  ¬•<%= number_with_delimiter(live_event.price) %>
                </p>
              <% end %>
            </div>

            <% if live_event.description.present? %>
              <p class="card-text text-muted small mb-3">
                <%= truncate(live_event.description, length: 80) %>
              </p>
            <% end %>

            <div class="d-flex justify-content-between align-items-center">
              <!-- „ÅäÊ∞ó„Å´ÂÖ•„Çä„Éú„Çø„É≥ -->
              <div class="favorite-section">
                <% if current_user %>
                  <% if current_user.favorited?(live_event) %>
                    <%= button_to unfavorite_live_event_path(live_event),
                                  method: :delete,
                                  class: "btn btn-outline-danger btn-sm",
                                  title: "„ÅäÊ∞ó„Å´ÂÖ•„Çä„Åã„ÇâÂâäÈô§" do %>
                      <i class="fas fa-heart me-1"></i>
                      <span class="badge bg-danger"><%= live_event.favorites.count %></span>
                    <% end %>
                  <% else %>
                    <%= button_to favorite_live_event_path(live_event),
                                  method: :post,
                                  class: "btn btn-outline-primary btn-sm",
                                  title: "„ÅäÊ∞ó„Å´ÂÖ•„Çä„Å´ËøΩÂä†" do %>
                      <i class="far fa-heart me-1"></i>
                      <span class="badge bg-primary"><%= live_event.favorites.count %></span>
                    <% end %>
                  <% end %>
                <% else %>
                  <%= link_to login_path, class: "btn btn-outline-secondary btn-sm",
                      title: "„É≠„Ç∞„Ç§„É≥„Åó„Å¶„ÅäÊ∞ó„Å´ÂÖ•„ÇäÁôªÈå≤" do %>
                    <i class="far fa-heart me-1"></i>
                    <span class="badge bg-secondary">0</span>
                  <% end %>
                <% end %>
              </div>

              <!-- „Ç¢„ÇØ„Ç∑„Éß„É≥„Éú„Çø„É≥ -->
              <div class="btn-group">
                <%= link_to "Ë©≥Á¥∞", live_event_path(live_event),
                    class: "btn btn-outline-primary btn-sm" %>
                <% if live_event.ticket_url.present? %>
                  <%= link_to "„ÉÅ„Ç±„ÉÉ„Éà", live_event.ticket_url, target: "_blank",
                      class: "btn btn-success btn-sm" %>
                <% end %>
              </div>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  <% else %>
    <div class="col-12">
      <div class="text-center py-5">
        <i class="fas fa-music text-muted mb-3" style="font-size: 4rem;"></i>
        <h3 class="text-muted">„É©„Ç§„ÉñÊÉÖÂ†±„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü</h3>
        <p class="text-muted mb-4">Ê§úÁ¥¢Êù°‰ª∂„ÇíÂ§âÊõ¥„Åô„Çã„Åã„ÄÅÊñ∞„Åó„ÅÑ„É©„Ç§„ÉñÊÉÖÂ†±„ÇíËøΩÂä†„Åó„Å¶„Åø„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ</p>
        <%= link_to "„É©„Ç§„Éñ„ÇíËøΩÂä†„Åô„Çã", new_live_event_path, class: "btn btn-gradient btn-lg" %>
      </div>
    </div>
  <% end %>
</div>

<style>
  .hover-card {
    transition: all 0.3s ease;
  }

  .hover-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(0,0,0,0.15) !important;
  }

  .btn-gradient {
    background: linear-gradient(45deg, #667eea, #764ba2);
    border: none;
    color: white;
    transition: all 0.3s ease;
  }

  .btn-gradient:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    color: white;
  }
</style>
